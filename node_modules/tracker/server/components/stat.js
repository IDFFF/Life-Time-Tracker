
/**
 * stat module
 */
'use strict';

var Q = require('q');
var Search = require('../../search/search');
var statist = require('../../statist');
var helper = require('../../helper');
var _ = require('lodash');

exports.generate = function (options) {
    var deferred = Q.defer();
    Search.query(options)
        .then(function (queryResult) {
            var days = helper.megerLogsToDateType(queryResult, 'day');
            var result = statist.dispose(options, {
                days: days
            });
            result.days = _.sortBy(result.days, function (day) {
                return day.date;
            });
            deferred.resolve(result);
        }).catch(function (err) {
            deferred.reject(err);
        });
    return deferred.promise;
};