var Q = require('q');
var _ = require('lodash');
var extend = require('extend');
//models
var People = require('../model/People');



exports.query = function (options) {
    options = extend({}, options);
    if (options.id) {
        return queryPeopleById(options);
    } else {
        return queryPeopleByConditions(options);
    }
};

function queryPeopleById() {

}


function queryPeopleByConditions(options) {
    var deferred = Q.defer();
    var conditions = {};
    if (options.name) {
        conditions._id = new RegExp(options.name);
    }
    var queryOptions = getQueryOptions(options);
    var query = People.find(conditions, null, queryOptions);
    query.exec(function (err, peoples) {
        if (err) {
            deferred.reject(err);
            return;
        }
        if (_.isEmpty(peoples)) {
            deferred.resolve([]);
            return;
        }
        deferred.resolve(peoples);
    });

    return deferred.promise;
}

function getQueryOptions(userOptions) {
    return _.pick(userOptions, ['limit', 'skip']);
}
