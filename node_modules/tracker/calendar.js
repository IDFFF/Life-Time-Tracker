/**
 * calendar generator
 *
 * can be see as an entr for all calendar type
 */

'use strict';


//var fileHelper = require('../fileHelper');
var Q = require('q');


var Search = require('./search/search');
var statist = require('./statist');
var helper = require('./helper');


exports.generate = function (options) {
    var deferred = Q.defer();
    Search.query(options)
        .then(function (queryResult) {
            var result = [];
            var days = helper.megerLogsToDateType(queryResult, 'day');
            var statResult = statist.dispose(options, {
                days: days
            });
            statResult.days.forEach(function (day) {
                var logs = day.logs;
                var time = 0;
                logs.forEach(function (log){
                    time += log.len;
                });
                result.push({
                    date: day.date,
                    count: time
                });
            });
            deferred.resolve(result);
        }).catch(function (err) {
            deferred.reject(err);
        });
    return deferred.promise;
};